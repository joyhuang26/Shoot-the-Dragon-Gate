# 射龍門遊戲

這是一個多人撲克牌遊戲專案，使用 Python 開發，採用伺服器-客戶端架構。玩家可以透過客戶端連接至伺服器，進行即時的撲克牌操作，例如抽牌和下注。

---

## 模組

### 1. **客戶端模組（Client Module）**
   - **功能**：該模組主要負責與伺服器建立連接，並處理玩家的互動（如登入、註冊、發牌、下注等）。它還負責顯示 GUI 介面（例如登入頁面、牌桌頁面）以及處理玩家與伺服器之間的通訊。
   
   - **主要功能**：
     - **`connect_to_server()`**：與伺服器建立 TCP 連接。
     - **`on_login_click()`**：玩家登入。
     - **`on_register_click()`**：玩家註冊。
     - **`request_and_show_table_page()`**：向伺服器請求並顯示撲克牌。
     - **`display_cards()`**：顯示撲克牌在 GUI 上。
     - **`on_bet_click()`**：下注操作。
     - **`listen_for_broadcast()`**：持續監聽伺服器廣播的撲克牌變動。
     - **`on_logout_click()`**：處理登出。

   - **界面**：
     - 與伺服器端進行通信時，會發送和接收消息（例如玩家名稱、撲克牌等）。
     - 與用戶進行交互，使用 Tkinter 庫來顯示用戶介面（登入、註冊、發牌、下注等）。
   
   - **模組間關係**：
     - 依賴伺服器端模組提供撲克牌資料，並與伺服器進行交互。
     - 和遊戲邏輯相關的操作，如發牌、下注和結果顯示。

---

### 2. **伺服器端模組（Server Module）**
   - **功能**：該模組負責管理所有玩家的連接、處理玩家的請求、生成並廣播撲克牌，並確保遊戲邏輯的運行（例如發牌、下注等）。它是遊戲的核心控制中心。
   
   - **主要功能**：
     - **`accept_connections()`**：接受客戶端的連接請求並創建新的處理線程。
     - **`handle_client()`**：處理單個客戶端的請求，包括玩家的登入、發牌請求和消息處理。
     - **`broadcast_new_cards()`**：將新的撲克牌發送給所有在線的玩家。
     - **`compare_cards()`**：根據遊戲邏輯進行牌的比較，確定結果。

   - **界面**：
     - 和客戶端進行 TCP 連接，通過套接字發送和接收數據。
     - 處理客戶端的消息，並根據不同的請求進行響應（例如發送撲克牌、更新遊戲狀態）。
   
   - **模組間關係**：
     - 為每個玩家提供必要的數據，並接收來自玩家的操作請求。
     - 根據遊戲邏輯進行撲克牌的生成與更新，並廣播給所有玩家。

---

### 3. **遊戲邏輯模組（Game Logic Module）**
   - **功能**：該模組負責遊戲規則的實現，包括撲克牌的比較、玩家的下注邏輯以及根據遊戲結果調整玩家的餘額。這部分不直接處理界面顯示，主要處理遊戲運算。
   
   - **主要功能**：
     - **`compare_cards()`**：比較玩家的牌並計算結果（例如是否中龍柱，贏或輸）。
     - **`adjust_balance()`**：根據牌局結果調整玩家的餘額。
   
   - **界面**：
     - 與伺服器端模組進行數據交換，根據結果發送消息給客戶端。
     - 這個模組與客戶端和伺服器模組間的通訊主要是數據格式（撲克牌和遊戲結果）的交換。

   - **模組間關係**：
     - 這個模組在伺服器端運行，根據玩家的操作進行運算，並將結果返回給伺服器，然後由伺服器進行廣播。

---

### 4. **GUI 顯示模組（GUI Display Module）**
   - **功能**：該模組負責管理客戶端的圖形用戶界面，顯示登入頁面、牌桌頁面以及撲克牌。它負責與用戶進行交互（例如接收用戶的點擊事件）並顯示遊戲狀態。
   
   - **主要功能**：
     - **`show_login_page()`**：顯示登入頁面，包含玩家名稱輸入框和登入按鈕。
     - **`show_table_page()`**：顯示牌桌頁面，包含顯示撲克牌、下注按鈕等。
     - **`display_cards()`**：更新牌桌上的撲克牌顯示。
   
   - **界面**：
     - 使用 Tkinter 顯示不同的視窗界面，根據用戶的操作顯示遊戲狀態。
   
   - **模組間關係**：
     - 接收來自伺服器端的撲克牌和遊戲結果，並根據這些數據更新顯示界面。
     - 當用戶進行操作（如登入、下注等）時，將操作傳遞給伺服器進行處理。

---

### 模組間的關係與界面設計：

1. **客戶端與伺服器之間的通訊**：
   - 客戶端與伺服器之間的通訊是基於套接字（socket）協議進行的。客戶端會向伺服器發送玩家的名稱、發牌請求、下注請求等，伺服器會處理這些請求並回傳撲克牌或遊戲結果。

2. **伺服器與遊戲邏輯的交互**：
   - 當伺服器接收到玩家的發牌請求時，它會根據遊戲邏輯模組的規則重新生成撲克牌，並決定每個玩家的結果（例如下注結果）。

3. **伺服器與 GUI 顯示模組的關係**：
   - 伺服器端模組會向客戶端發送撲克牌，並在遊戲過程中更新撲克牌和遊戲結果。GUI 顯示模組會根據伺服器發送的數據更新玩家界面（例如顯示新的撲克牌、更新玩家的餘額等）。

4. **遊戲邏輯與 GUI 顯示模組的交互**：
   - 遊戲邏輯模組負責計算遊戲結果並調整玩家的餘額，這些結果會被傳遞到伺服器端，最終顯示在客戶端的 GUI 界面上。

### 子模組總結：

1. **客戶端模組**：處理與伺服器的通信，顯示 GUI 介面，並負責處理玩家的輸入。
2. **伺服器端模組**：管理玩家連接，處理請求並進行遊戲狀態管理。
3. **遊戲邏輯模組**：執行遊戲規則和結果運算，並與伺服器端交互。
4. **GUI 顯示模組**：負責顯示界面，讓玩家進行互動，並更新遊戲的視覺效果。

---

## 文獻參考

- [過年必玩【射龍門玩法規則】越簡單越好玩](https://blog.qywin88.com/all-articles/board/shootgoal/)
- [射龍門](http://www.rcauee.tw/game/shotgantry.html)
- [《射龍門：深入探究遊戲規則與專業級技巧》](https://www.baccaratdago.com.tw/%E3%80%8A%E5%B0%84%E9%BE%8D%E9%96%80%EF%BC%9A%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6%E9%81%8A%E6%88%B2%E8%A6%8F%E5%89%87%E8%88%87%E5%B0%88%E6%A5%AD%E7%B4%9A%E6%8A%80%E5%B7%A7%E3%80%8B/)

---

## Client 及 Server 運作的流程

1. **登入/註冊階段**  
   - **Client** 向 **Server** 發送登入或註冊請求。
   - **Server** 回應成功或失敗的結果，告訴 **Client** 登入是否成功。
   
   ```
   Client -> Server : 點擊登入/註冊
   Server -> Client : 回傳登入成功 / 失敗
   ```

2. **發牌請求階段**  
   - **Client** 向 **Server** 發送請求，要求發牌（請求撲克牌資料）。
   - **Server** 根據請求回應一組撲克牌資料給 **Client**。
   
   ```
   Client -> Server : 請求發牌 (GET_CARDS)
   Server -> Client : 回傳撲克牌資料
   ```

3. **下注階段**  
   - **Client** 向 **Server** 發送下注請求，提交玩家的下注金額。
   - **Server** 進行卡牌比較及計算結果，回傳結算結果給 **Client**。
   
   ```
   Client -> Server : 發送下注請求 (下注金額)
   Server -> Client : 進行卡牌比較及結算結果
   ```

4. **籌碼調整**  
   - 在 **Client** 和 **Server** 之間，根據結算結果，玩家的籌碼會進行調整。
   
   ```
   note over Client, Server : 玩家根據結果獲得相應的籌碼調整
   ```

5. **更新撲克牌階段**  
   - **Client** 發送請求，要求獲得新的撲克牌（例如換牌）。
   - **Server** 回傳新的撲克牌資料。
   
   ```
   Client -> Server : 請求新的撲克牌 (NEW_CARDS)
   Server -> Client : 回傳新撲克牌
   ```

6. **持續更新**  
   - 根據玩家的請求， **Client** 可以繼續向 **Server** 請求更新撲克牌資料。
   
   ```
   note over Client, Server : 可以根據玩家請求更新撲克牌
   ```
